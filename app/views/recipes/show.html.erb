<%= link_to "Back to Recipes", recipes_path %>

<h1><%= @recipe.name %></h1>

<%= link_to "Average Rating:", recipe_ratings_path(@recipe) %><br>

<% if current_user.ratings.find_by(recipe_id: @recipe.id) == nil %>
  <%= link_to "Rate this Recipe", new_recipe_rating_path(@recipe) %>
<% else %>
  You rated this recipe:
  <% user_rating = current_user.ratings.find_by(recipe_id: @recipe.id) %>
  <%= user_rating.rating %>
<% end %><br><br>

<p><%= @recipe.description %></p>

Category: <%= @recipe.category.name %><br><br>

Ingredients:
<table>
  <tr>
    <th>Name</th>
    <th>Quantity</th>
  </tr>
<% @ingredients.each do |ingredient| %>
  <tr>
    <td><%= ingredient.name %></td>
    <td>
    <% recipe_ingredient = RecipeIngredient.where(recipe_id: @recipe.id, ingredient_id: ingredient.id) %>
    <%= recipe_ingredient.first.quantity %>
    </td>
  </tr>
<% end %>
</table><br>

<% if @recipe.user_id == current_user.id %>
  <%= link_to "Edit", edit_recipe_path(@recipe) %>
  <%= link_to "Delete", recipe_path(@recipe), method: :delete %>
<% end %>
<br><br>

Have
<% key_ingredient_array = RecipeIngredient.where(recipe_id: @recipe.id, key_ingredient: true).to_a%>
<% key_ingredient_array.each do |k| %>
  <% ingredient = Ingredient.find(k.ingredient_id) %>
  <%= link_to ingredient.name, ingredient_recipes_path(ingredient), :recipe_id => @recipe.id %>
<% end %>
left over?
